{% extends "base.html" %}

{% block title %}æŠ½å¥–ç³»ç»Ÿ - WXZYç‚¹é¤ç³»ç»Ÿ{% endblock %}

{% block content %}
<div class="lottery-container">
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜å’Œä½™é¢ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <!-- è¿”å›æŒ‰é’® -->
                        <button class="btn btn-outline-primary me-3" onclick="goBack()" title="è¿”å›ä¸Šä¸€é¡µ">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h1 class="display-6 text-dark mb-0">
                            <i class="fas fa-gift text-warning me-3"></i>
                            æŠ½å¥–ç³»ç»Ÿ
                        </h1>
                    </div>
                    <div class="balance-display">
                        <div class="card bg-gradient-warning text-dark">
                            <div class="card-body text-center py-2">
                                <h5 class="mb-0 fw-bold">
                                    <i class="fas fa-coins me-2"></i>
                                    <span id="userBalance">{{ balance }}</span> å®å®å¸
                                </h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æŠ½å¥–å¡æ±  -->
        <div class="row">
            <!-- æ™®é€šæŠ½å¡ -->
            <div class="col-lg-4 mb-4">
                <div class="card lottery-card normal-card h-100">
                    <div class="card-header text-center">
                        <h4 class="mb-0">
                            <i class="fas fa-star text-success me-2"></i>
                            æ™®é€šæŠ½å¡
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <div class="lottery-icon">
                                <i class="fas fa-gift-card" style="font-size: 3rem; color: #28a745;"></i>
                            </div>
                        </div>
                        <div class="lottery-info">
                            <h5 class="text-center mb-3">52 å®å®å¸</h5>
                            <div class="mb-3">
                                <button class="btn btn-sm btn-outline-info" onclick="showPrizePool('normal')">
                                    <i class="fas fa-list me-1"></i>æŸ¥çœ‹å¥–æ± 
                                </button>
                            </div>
                            <div class="reward-preview">
                                <div class="reward-item">
                                    <span class="badge bg-success">40.00%</span> 25ä¸ªå®å®å¸
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-warning">7.50%</span> ä¹æŠ˜ä¼˜æƒ åˆ¸
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-secondary">10.00%</span> æ‰£é™¤20å®å®å¸
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-info">10.25%</span> å„ç§ç¢ç‰‡/å®ç‰©
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-primary">30.00%</span> å®å®å¸10æš
                                </div>
                                <div class="small text-muted">ç‚¹å‡»æŸ¥çœ‹å¥–æ± æŸ¥çœ‹å®Œæ•´åˆ—è¡¨</div>
                            </div>
                        </div>
                        <div class="text-center">
                            <button type="button" class="btn btn-success mb-2" onclick="drawCard('normal', false)">
                                <i class="fas fa-gift me-2"></i>å•æŠ½ (52å¸)
                            </button>
                            <button type="button" class="btn btn-outline-success" onclick="drawCard('normal', true)">
                                <i class="fas fa-gifts me-2"></i>åè¿æŠ½ (520å¸)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- é«˜çº§æŠ½å¡ -->
            <div class="col-lg-4 mb-4">
                <div class="card lottery-card premium-card h-100">
                    <div class="card-header text-center">
                        <h4 class="mb-0">
                            <i class="fas fa-star text-primary me-2"></i>
                            <i class="fas fa-star text-primary me-2"></i>
                            é«˜çº§æŠ½å¡
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <div class="lottery-icon">
                                <i class="fas fa-gem" style="font-size: 3rem; color: #007bff;"></i>
                            </div>
                        </div>
                        <div class="lottery-info">
                            <h5 class="text-center mb-3">520 å®å®å¸</h5>
                            <div class="mb-3">
                                <button class="btn btn-sm btn-outline-info" onclick="showPrizePool('premium')">
                                    <i class="fas fa-list me-1"></i>æŸ¥çœ‹å¥–æ± 
                                </button>
                            </div>
                                <div class="reward-item">
                                    <span class="badge bg-success">11.25%</span> æŒ‰æ‘©15åˆ†é’Ÿ
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-info">50.00%</span> 200ä¸ªå®å®å¸
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-warning">20.00%</span> æ‰£é™¤50å®å®å¸
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-secondary">1.25%</span> å…¶ä»–å¥–å“
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-primary">1.00%</span> éº¦è¾£é¸¡è…¿å ¡2/å¥¶èŒ¶é¼ ç©å¶
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-danger">0.50%</span> 100rè¡£æœå…‘æ¢åˆ¸
                                </div>
                        </div>
                        <div class="text-center">
                            <button type="button" class="btn btn-primary mb-2" onclick="drawCard('premium', false)">
                                <i class="fas fa-gift me-2"></i>å•æŠ½ (520å¸)
                            </button>
                            <button type="button" class="btn btn-outline-primary" onclick="drawCard('premium', true)">
                                <i class="fas fa-gifts me-2"></i>ä¸ƒè¿æŠ½ (3640å¸)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- è¶…çº§æŠ½å¡ -->
            <div class="col-lg-4 mb-4">
                <div class="card lottery-card ultimate-card h-100">
                    <div class="card-header text-center">
                        <h4 class="mb-0">
                            <i class="fas fa-star text-warning me-2"></i>
                            <i class="fas fa-star text-warning me-2"></i>
                            <i class="fas fa-star text-warning me-2"></i>
                            è¶…çº§æŠ½å¡
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <div class="lottery-icon">
                                <i class="fas fa-crown" style="font-size: 3rem; color: #ffc107;"></i>
                            </div>
                        </div>
                        <div class="lottery-info">
                            <h5 class="text-center mb-3">1314 å®å®å¸</h5>
                            <div class="mb-3">
                                <button class="btn btn-sm btn-outline-info" onclick="showPrizePool('ultimate')">
                                    <i class="fas fa-list me-1"></i>æŸ¥çœ‹å¥–æ± 
                                </button>
                            </div>
                            <div class="reward-preview">
                                <div class="reward-item">
                                    <span class="badge bg-success">50%</span> 520ä¸ªå®å®å¸
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-warning">15%</span> 1314ä¸ªå®å®å¸
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-info">10%</span> è‚ ç²‰ä¸€é¡¿
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-danger">5%</span> å®å®æŒ‰æ‘©30åˆ†é’Ÿ
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-secondary">20%</span> å…¶ä»–å¥–å“
                                </div>
                                <div class="small text-muted">ç‚¹å‡»æŸ¥çœ‹å¥–æ± æŸ¥çœ‹å®Œæ•´åˆ—è¡¨</div>
                            </div>
                        </div>
                        <div class="text-center">
                            <button type="button" class="btn btn-warning mb-2" onclick="drawCard('ultimate', false)">
                                <i class="fas fa-gift me-2"></i>å•æŠ½ (1314å¸)
                            </button>
                            <button type="button" class="btn btn-outline-warning" onclick="drawCard('ultimate', true)">
                                <i class="fas fa-gifts me-2"></i>äº”è¿æŠ½ (6570å¸)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç©¶ææŠ½å¡ -->
            <div class="col-lg-3 mb-4">
                <div class="card lottery-card legendary-card h-100">
                    <div class="card-header text-center">
                        <h4 class="mb-0">
                            <i class="fas fa-star text-danger me-2"></i>
                            <i class="fas fa-star text-danger me-2"></i>
                            <i class="fas fa-star text-danger me-2"></i>
                            <i class="fas fa-star text-danger me-2"></i>
                            ç©¶ææŠ½å¡
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <div class="lottery-icon">
                                <i class="fas fa-diamond" style="font-size: 3rem; color: #dc3545;"></i>
                            </div>
                        </div>
                        <div class="lottery-info">
                            <h5 class="text-center mb-3">5200 å®å®å¸</h5>
                            <div class="mb-3">
                                <button class="btn btn-sm btn-outline-info" onclick="showPrizePool('legendary')">
                                    <i class="fas fa-list me-1"></i>æŸ¥çœ‹å¥–æ± 
                                </button>
                            </div>
                            <div class="reward-preview">
                                <div class="reward-item">
                                    <span class="badge bg-success">40%</span> 1314ä¸ªå®å®å¸
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-warning">20%</span> æ–°å·´å…‹
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-info">19%</span> 5200ä¸ªå®å®å¸
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-danger">5.5%</span> æŒ‰æ‘©45åˆ†é’Ÿ
                                </div>
                                <div class="reward-item">
                                    <span class="badge bg-secondary">15.5%</span> æƒŠå–œå¤§ç¤¼
                                </div>
                                <div class="small text-muted">ç‚¹å‡»æŸ¥çœ‹å¥–æ± æŸ¥çœ‹å®Œæ•´åˆ—è¡¨</div>
                            </div>
                        </div>
                        <div class="text-center">
                            <button type="button" class="btn btn-danger mb-2" onclick="drawCard('legendary', false)">
                                <i class="fas fa-gift me-2"></i>å•æŠ½ (5200å¸)
                            </button>
                            <button type="button" class="btn btn-outline-danger" onclick="drawCard('legendary', true)">
                                <i class="fas fa-gifts me-2"></i>ä¸‰è¿æŠ½ (15600å¸)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æŠ½å¥–ç»“æœæ¨¡æ€æ¡† -->
        <div class="modal fade" id="resultModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">æŠ½å¥–ç»“æœ</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div id="drawResults" class="row"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                        <a href="/inventory_page" class="btn btn-primary">æŸ¥çœ‹å®åŒ…</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¥–æ± è¯¦æƒ…æ¨¡æ€æ¡† -->
        <div class="modal fade" id="prizePoolModal" tabindex="-1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="prizePoolTitle">å¥–æ± è¯¦æƒ…</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div id="prizePoolContent">
                            <!-- åŠ¨æ€åŠ è½½å¥–æ± å†…å®¹ -->
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.lottery-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #f1f5f9 100%);
    padding: 2rem 0;
}

.lottery-card {
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    border: none;
    border-radius: 20px;
    transition: transform 0.3s ease;
    background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
}

.lottery-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 40px rgba(0,0,0,0.4);
}

.normal-card .card-header {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%) !important;
    color: white !important;
    border-radius: 20px 20px 0 0 !important;
}

.premium-card .card-header {
    background: linear-gradient(135deg, #007bff 0%, #6610f2 100%) !important;
    color: white !important;
    border-radius: 20px 20px 0 0 !important;
}

.ultimate-card .card-header {
    background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%) !important;
    color: white !important;
    border-radius: 20px 20px 0 0 !important;
}

.legendary-card .card-header {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%) !important;
    color: white !important;
    border-radius: 20px 20px 0 0 !important;
}

.lottery-icon {
    margin: 1rem 0;
}

.reward-list {
    max-height: 200px;
    overflow-y: auto;
    margin-bottom: 1rem;
}

.reward-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 0.5rem 0;
    font-size: 0.9rem;
}

.prize-pool-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    background: rgba(0,0,0,0.05);
    border-radius: 8px;
    border-left: 4px solid;
}

.prize-pool-item.physical-item {
    border-left-color: #e74c3c;
}

.prize-pool-item.fragment-item {
    border-left-color: #9b59b6;
}

.prize-pool-item.balance-item {
    border-left-color: #f39c12;
}

.prize-pool-item.coupon-item {
    border-left-color: #3498db;
}

.prize-pool-item.special-item {
    border-left-color: #2ecc71;
}

.prize-description {
    flex: 1;
    margin-right: 1rem;
}

.prize-name {
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.prize-desc {
    font-size: 0.875rem;
    color: #666;
    margin: 0;
}

.balance-display .card {
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    background: linear-gradient(145deg, #ffc107 0%, #ff8f00 100%) !important;
}

.btn-outline-light {
    border: 2px solid rgba(255,255,255,0.6);
    color: #ffffff;
    font-weight: 600;
    border-radius: 15px;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.btn-outline-light:hover {
    background-color: rgba(255,255,255,0.2);
    border-color: #ffffff;
    color: #ffffff;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(255,255,255,0.2);
}

.btn-outline-primary {
    border: 2px solid #007bff;
    color: #007bff;
    font-weight: 600;
    border-radius: 15px;
    transition: all 0.3s ease;
}

.btn-outline-primary:hover {
    background-color: #007bff;
    border-color: #007bff;
    color: #ffffff;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,123,255,0.3);
}

.btn-success {
    background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
    border: none;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-success:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(40,167,69,0.3);
}

.btn-primary {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    border: none;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,123,255,0.3);
}

.btn-warning {
    background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
    border: none;
    border-radius: 10px;
    font-weight: 600;
    color: #212529;
    transition: all 0.3s ease;
}

.btn-warning:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(255,193,7,0.3);
    color: #212529;
}

.btn-outline-success, .btn-outline-primary, .btn-outline-warning {
    border-width: 2px;
    font-weight: 600;
    border-radius: 10px;
    transition: all 0.3s ease;
}

.btn-outline-success:hover, .btn-outline-primary:hover, .btn-outline-warning:hover {
    transform: translateY(-2px);
}

.draw-result {
    text-align: center;
    margin-bottom: 1rem;
    padding: 1rem;
    border-radius: 15px;
    border: 2px solid #ddd;
    transition: all 0.3s ease;
}

.draw-result.rare {
    background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
    color: white;
    border-color: #fd7e14;
    box-shadow: 0 4px 15px rgba(255,193,7,0.3);
}

.draw-result.epic {
    background: linear-gradient(135deg, #6610f2 0%, #e83e8c 100%);
    color: white;
    border-color: #e83e8c;
    box-shadow: 0 4px 15px rgba(102,16,242,0.3);
}

.draw-result.legendary {
    background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
    color: white;
    border-color: #fd7e14;
    box-shadow: 0 4px 15px rgba(220,53,69,0.3);
}

.modal-content {
    border-radius: 20px;
    border: none;
    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
}

.modal-header {
    border-radius: 20px 20px 0 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-bottom: none;
}

.modal-footer {
    border-radius: 0 0 20px 20px;
    border-top: 1px solid #dee2e6;
}
</style>

<script>
// å¥–æ± æ•°æ®
const prizePoolData = {
    normal: [
        { name: 'é¢åŒ…', probability: 1.25, type: 'physical-item', description: 'é¢åŒ…ï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: 'å¾·æ¹˜å¨å…‘æ¢åˆ¸ç¢ç‰‡', probability: 1.50, type: 'fragment-item', description: 'å¾·æ¹˜å¨å…‘æ¢åˆ¸ç¢ç‰‡ï¼ˆåœ¨èƒŒåŒ…ä¸­10ä¸ªåˆæˆä¸€ä¸ªå®é™…ç‰©å“æ‰èƒ½ä½¿ç”¨ï¼‰' },
        { name: 'é‡‘æˆˆæˆˆç¢ç‰‡', probability: 1.50, type: 'fragment-item', description: 'é‡‘æˆˆæˆˆç¢ç‰‡ï¼ˆåœ¨èƒŒåŒ…ä¸­10ä¸ªåˆæˆä¸€ä¸ªå®é™…ç‰©å“æ‰èƒ½ä½¿ç”¨ï¼‰' },
        { name: 'é»‘å’–å•¡ä¸€æ¯', probability: 1.25, type: 'physical-item', description: 'é»‘å’–å•¡ä¸€æ¯ï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: 'éº¦è¾£é¸¡è…¿å ¡ç¢ç‰‡', probability: 2.50, type: 'fragment-item', description: 'éº¦è¾£é¸¡è…¿å ¡ç¢ç‰‡ï¼ˆåœ¨èƒŒåŒ…ä¸­10ä¸ªåˆæˆä¸€ä¸ªå®é™…ç‰©å“æ‰èƒ½ä½¿ç”¨ï¼‰' },
        { name: 'å¥¥å°”è‰¯é¸¡è…¿å ¡ç¢ç‰‡', probability: 2.50, type: 'fragment-item', description: 'å¥¥å°”è‰¯é¸¡è…¿å ¡ç¢ç‰‡ï¼ˆåœ¨èƒŒåŒ…ä¸­10ä¸ªåˆæˆä¸€ä¸ªå®é™…ç‰©å“æ‰èƒ½ä½¿ç”¨ï¼‰' },
        { name: 'å¥¶èŒ¶ä¸€æ¯', probability: 1.00, type: 'physical-item', description: 'å¥¶èŒ¶ä¸€æ¯ï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: 'ç´«èœå·', probability: 1.00, type: 'physical-item', description: 'ç´«èœå·ï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: 'ä¹æŠ˜ä¼˜æƒ åˆ¸', probability: 7.50, type: 'coupon-item', description: 'ä¹æŠ˜ä¼˜æƒ åˆ¸' },
        { name: 'å®å®å¸25ä¸ª', probability: 40.00, type: 'balance-item', description: 'è·å¾—25ä¸ªå®å®å¸' },
        { name: 'æ‰£é™¤20å®å®å¸', probability: 10.00, type: 'balance-item', description: 'æ‰£é™¤20ä¸ªå®å®å¸' },
        { name: 'å®å®å¸10æš', probability: 30.00, type: 'balance-item', description: 'è·å¾—10ä¸ªå®å®å¸' }
    ],
    premium: [
        { name: 'æŒ‰æ‘©15åˆ†é’Ÿ', probability: 11.25, type: 'physical-item', description: 'æŒ‰æ‘©15åˆ†é’Ÿï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: 'ç•ªèŒ„æˆå“', probability: 1.25, type: 'physical-item', description: 'ç•ªèŒ„æˆå“ï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: 'æ‰£é™¤50å®å®å¸', probability: 20.00, type: 'balance-item', description: 'æ‰£é™¤50å®å®å¸' },
        { name: 'èŠ’æœï¼Œè¥¿ç“œ', probability: 1.25, type: 'physical-item', description: 'èŠ’æœï¼Œè¥¿ç“œï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: 'é¦™è•‰ï¼Œç«é¾™æœ', probability: 1.25, type: 'physical-item', description: 'é¦™è•‰ï¼Œç«é¾™æœï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: '100rè¡£æœå…‘æ¢åˆ¸ï¼ˆå®é™…ç‰©å“ï¼‰æƒŠå–œå¤§ç¤¼', probability: 0.5, type: 'physical-item', description: '100rè¡£æœå…‘æ¢åˆ¸ï¼ˆå®é™…ç‰©å“ï¼‰æƒŠå–œå¤§ç¤¼' },
        { name: 'æŒ‰æ‘©30åˆ†é’Ÿ', probability: 1.25, type: 'physical-item', description: 'æŒ‰æ‘©30åˆ†é’Ÿï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: 'å…­æŠ˜ä¼˜æƒ åˆ¸', probability: 1.25, type: 'coupon-item', description: 'å…­æŠ˜ä¼˜æƒ åˆ¸' },
        { name: 'å…å•åˆ¸', probability: 1.25, type: 'coupon-item', description: 'å…å•åˆ¸' },
        { name: 'å¤–å–ç›²ç›’', probability: 1.25, type: 'physical-item', description: 'å¤–å–ç›²ç›’ï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: '200ä¸ªå®å®å¸', probability: 52.5, type: 'balance-item', description: 'è·å¾—200ä¸ªå®å®å¸' },
        { name: 'éº¦è¾£é¸¡è…¿å ¡2', probability: 1.0, type: 'physical-item', description: 'éº¦è¾£é¸¡è…¿å ¡2ï¼ˆå®é™…ç‰©å“å¯ç›´æ¥ä½¿ç”¨ï¼‰' },
        { name: 'å¥¶èŒ¶é¼ ç©å¶', probability: 1.0, type: 'fragment-item', description: 'å¥¶èŒ¶é¼ ç©å¶ï¼ˆåœ¨èƒŒåŒ…ä¸­5ä¸ªåˆæˆä¸€ä¸ªå®é™…ç‰©å“æ‰èƒ½ä½¿ç”¨ï¼‰' },
        { name: 'è’é‡ä¹±æ–—ä¹±æ–—é‡‘åˆ¸ğŸ¤ª', probability: 1.25, type: 'fragment-item', description: 'è’é‡ä¹±æ–—ä¹±æ–—é‡‘åˆ¸ğŸ¤ªï¼ˆåœ¨èƒŒåŒ…ä¸­5ä¸ªåˆæˆä¸€ä¸ªå®é™…ç‰©å“æ‰èƒ½ä½¿ç”¨ï¼‰' },
        { name: 'æ˜Ÿå·´å…‹ä¸€æ¯', probability: 1.25, type: 'fragment-item', description: 'æ˜Ÿå·´å…‹ä¸€æ¯ï¼ˆåœ¨èƒŒåŒ…ä¸­4ä¸ªåˆæˆä¸€ä¸ªå®é™…ç‰©å“æ‰èƒ½ä½¿ç”¨ï¼‰' },
        { name: 'å¯¿å¸éƒç¢ç‰‡', probability: 1.25, type: 'fragment-item', description: 'å¯¿å¸éƒç¢ç‰‡ï¼ˆåœ¨èƒŒåŒ…ä¸­9ä¸ªåˆæˆä¸€ä¸ªå®é™…ç‰©å“æ‰èƒ½ä½¿ç”¨ï¼‰' },
        { name: 'æ°´ç‰›å¥¶ä¸€ç®±', probability: 1.25, type: 'fragment-item', description: 'æ°´ç‰›å¥¶ä¸€ç®±ï¼ˆåœ¨èƒŒåŒ…ä¸­4ä¸ªåˆæˆä¸€ä¸ªå®é™…ç‰©å“æ‰èƒ½ä½¿ç”¨ï¼‰' }
    ],
    ultimate: [
        { name: 'å¯¿å¸éƒä¸€é¡¿', probability: 1.5, type: 'physical-item', description: 'å¯¿å¸éƒä¸€é¡¿ï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: 'é¸¡èƒ¸è‚‰å¥—é¤', probability: 2.5, type: 'physical-item', description: 'é¸¡èƒ¸è‚‰å¥—é¤ï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: '100rè¡£æœå…‘æ¢åˆ¸', probability: 1.0, type: 'physical-item', description: '100rè¡£æœå…‘æ¢åˆ¸ï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: '520ä¸ªå®å®å¸', probability: 50.0, type: 'balance-item', description: 'è·å¾—520ä¸ªå®å®å¸' },
        { name: 'å…å•åˆ¸', probability: 2.5, type: 'coupon-item', description: 'å…å•åˆ¸' },
        { name: '5200ä¸ªå®å®å¸', probability: 2.5, type: 'balance-item', description: 'è·å¾—5200ä¸ªå®å®å¸' },
        { name: '1314ä¸ªå®å®å¸', probability: 15.0, type: 'balance-item', description: 'è·å¾—1314ä¸ªå®å®å¸' },
        { name: '52ä¸ªå®å®å¸', probability: 6.5, type: 'balance-item', description: 'è·å¾—52ä¸ªå®å®å¸' },
        { name: 'è¡¥ç­¾å¡', probability: 1.0, type: 'special-item', description: 'è·å¾—1å¼ è¡¥ç­¾å¡' },
        { name: 'æ°´ç‰›å¥¶', probability: 3.0, type: 'physical-item', description: 'æ°´ç‰›å¥¶ï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: 'å®å®æŒ‰æ‘©30åˆ†é’Ÿ', probability: 5.0, type: 'physical-item', description: 'å®å®æŒ‰æ‘©30åˆ†é’Ÿï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: 'è‚ ç²‰ä¸€é¡¿', probability: 10.0, type: 'physical-item', description: 'è‚ ç²‰ä¸€é¡¿ï¼ˆå®é™…ç‰©å“ï¼‰' }
    ],
    legendary: [
        { name: 'å¯¿å¸éƒä¸€é¤', probability: 5.0, type: 'physical-item', description: 'å¯¿å¸éƒä¸€é¤ï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: '5200å®å®å¸', probability: 19.0, type: 'balance-item', description: 'è·å¾—5200ä¸ªå®å®å¸' },
        { name: '1314å®å®å¸', probability: 40.0, type: 'balance-item', description: 'è·å¾—1314ä¸ªå®å®å¸' },
        { name: '13140å®å®å¸', probability: 2.5, type: 'balance-item', description: 'è·å¾—13140ä¸ªå®å®å¸' },
        { name: 'å¥¶èŒ¶é¼ ç©å¶', probability: 3.0, type: 'physical-item', description: 'å¥¶èŒ¶é¼ ç©å¶ï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: 'æ–°å·´å…‹', probability: 20.0, type: 'physical-item', description: 'æ–°å·´å…‹ï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: 'æŒ‰æ‘©45åˆ†é’Ÿ', probability: 5.5, type: 'physical-item', description: 'æŒ‰æ‘©45åˆ†é’Ÿï¼ˆå®é™…ç‰©å“ï¼‰' },
        { name: 'æƒŠå–œå¤§ç¤¼', probability: 5.0, type: 'special-item', description: 'ç¥ç§˜æƒŠå–œå¤§ç¤¼' }
    ]
};

function showPrizePool(poolType) {
    const modal = new bootstrap.Modal(document.getElementById('prizePoolModal'));
    const title = document.getElementById('prizePoolTitle');
    const content = document.getElementById('prizePoolContent');
    
    // è®¾ç½®æ ‡é¢˜
    const titles = {
        'normal': 'æ™®é€šæŠ½å¥–å¥–æ± ',
        'premium': 'é«˜çº§æŠ½å¥–å¥–æ± ',
        'ultimate': 'è¶…çº§æŠ½å¥–å¥–æ± ',
        'legendary': 'ç©¶ææŠ½å¥–å¥–æ± '
    };
    title.textContent = titles[poolType];
    
    // ç”Ÿæˆå¥–æ± å†…å®¹
    const prizes = prizePoolData[poolType];
    let html = '<div class="row">';
    
    prizes.forEach(prize => {
        // å¯¹äºæƒŠå–œå¤§ç¤¼ï¼ˆswitchç¢ç‰‡ï¼‰ï¼Œæ ¹æ®ç”¨æˆ·çŠ¶æ€æ˜¾ç¤ºä¸åŒå†…å®¹
        let displayName = prize.name;
        let displayDesc = prize.description;
        
        if (prize.name === 'æƒŠå–œå¤§ç¤¼' && hasSwitchFragments) {
            displayName = 'ğŸ® ç¥ç§˜æ¸¸æˆè®¾å¤‡ç¢ç‰‡';
            displayDesc = 'ç¥ç§˜çš„æ¸¸æˆè®¾å¤‡ç¢ç‰‡ï¼Œæ”¶é›†12ä¸ªå³å¯åˆæˆå®Œæ•´è®¾å¤‡';
        }
        
        html += `
            <div class="col-md-6 col-lg-4 mb-3">
                <div class="prize-pool-item ${prize.type}">
                    <div class="prize-description">
                        <div class="prize-name">${displayName}</div>
                        <p class="prize-desc">${displayDesc}</p>
                    </div>
                    <span class="badge bg-primary">${prize.probability}%</span>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    content.innerHTML = html;
    
    modal.show();
}

let currentBalance = {{ balance }};
let hasSwitchFragments = {{ has_switch_fragments|lower }};

function goBack() {
    // æ£€æŸ¥æ˜¯å¦æœ‰å†å²è®°å½•å¯ä»¥è¿”å›
    if (window.history.length > 1) {
        window.history.back();
    } else {
        // å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œè¿”å›åˆ°å®¢æˆ·ç«¯ä¸»é¡µ
        window.location.href = '/customer';
    }
}

function drawCard(type, tenDraw) {
    const costs = {'normal': 52, 'premium': 520, 'ultimate': 1314, 'legendary': 5200};
    let maxDraw = 10;
    if (type === 'premium') maxDraw = 7;
    if (type === 'ultimate') maxDraw = 5;
    if (type === 'legendary') maxDraw = 3; // ç©¶æä¸‰è¿æŠ½
    const drawCount = tenDraw ? maxDraw : 1;
    const cost = costs[type] * drawCount;

    if (currentBalance < cost) {
        showToast('å®å®å¸ä¸è¶³ï¼', 'error');
        return;
    }

    // ç¡®è®¤æŠ½å¥–
    let drawText = 'å•æ¬¡';
    if (tenDraw) {
        if (type === 'premium') drawText = '7è¿';
        else if (type === 'ultimate') drawText = '5è¿';
        else if (type === 'legendary') drawText = 'ä¸‰è¿';
        else drawText = 'åè¿';
    }
    const confirmMessage = `ç¡®å®šè¦è¿›è¡Œ${drawText}æŠ½å¥–å—ï¼Ÿ\nè´¹ç”¨ï¼š${cost}ä¸ªå®å®å¸`;
    if (!confirm(confirmMessage)) {
        return;
    }

    fetch('/lottery_draw', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            type: type,
            ten_draw: tenDraw
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            currentBalance = data.new_balance;
            document.getElementById('userBalance').textContent = currentBalance;
            showDrawResults(data.results, tenDraw);
        } else {
            showToast(data.message || 'æŠ½å¥–å¤±è´¥', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('æŠ½å¥–å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
    });
}

function showDrawResults(results, tenDraw) {
    const resultsContainer = document.getElementById('drawResults');
    resultsContainer.innerHTML = '';
    
    results.forEach((result, index) => {
        const resultDiv = document.createElement('div');
        resultDiv.className = 'col-md-6 mb-3';
        
        let cardClass = '';
        if (result.name.includes('520') || result.name.includes('Switch') || result.name.includes('å¯¿å¸éƒ')) {
            cardClass = 'legendary';
        } else if (result.name.includes('è’é‡ä¹±æ–—') || result.name.includes('5æŠ˜') || result.name.includes('600')) {
            cardClass = 'epic';
        } else if (result.name.includes('ä¼˜æƒ åˆ¸') || result.name.includes('70')) {
            cardClass = 'rare';
        }
        
        resultDiv.innerHTML = `
            <div class="draw-result ${cardClass}">
                <h6>${result.name.includes('switchç¢ç‰‡') ? (hasSwitchFragments ? 'ğŸ® ç¥ç§˜æ¸¸æˆè®¾å¤‡ç¢ç‰‡' : 'ğŸ æƒŠå–œå¤§ç¤¼') : result.name}</h6>
                <p class="mb-0">${result.name.includes('switchç¢ç‰‡') ? (hasSwitchFragments ? 'ç¥ç§˜çš„æ¸¸æˆè®¾å¤‡ç¢ç‰‡ï¼Œæ”¶é›†12ä¸ªå³å¯åˆæˆå®Œæ•´è®¾å¤‡' : 'ç¥ç§˜çš„æƒŠå–œå¤§ç¤¼ï¼Œè·å¾—åå°†æ­å¼€è°œåº•') : result.description}</p>
            </div>
        `;
        
        resultsContainer.appendChild(resultDiv);
    });
    
    const modal = new bootstrap.Modal(document.getElementById('resultModal'));
    modal.show();
}

function showToast(message, type = 'info') {
    // åˆ›å»º toast å…ƒç´ 
    const toastHtml = `
        <div class="toast align-items-center text-white bg-${type === 'error' ? 'danger' : 'success'} border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body">${message}</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    `;
    
    // æ·»åŠ åˆ°é¡µé¢
    let toastContainer = document.getElementById('toastContainer');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toastContainer';
        toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
        toastContainer.style.zIndex = '9999';
        document.body.appendChild(toastContainer);
    }
    
    toastContainer.insertAdjacentHTML('beforeend', toastHtml);
    const toastElement = toastContainer.lastElementChild;
    const toast = new bootstrap.Toast(toastElement);
    toast.show();
    
    // 3ç§’åè‡ªåŠ¨ç§»é™¤
    setTimeout(() => {
        toastElement.remove();
    }, 3000);
}
</script>
{% endblock %}